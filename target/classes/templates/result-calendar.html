<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{blocks/template.html}">
<th:block layout:fragment="alert-content">
    <hr class="my-4">
    <div class="card">
        <div class="card-body">
            <h2 class="text-center">КАЛЕНДАРНЫЕ СРОКИ ПРОЕКТА</h2><br>
            <h5 class="fst-italic">Шифр договора: [[${codeContract}]]</h5>
            <h5 class="fst-italic">Основные характеристики проекта</h5>
            <p class="fst-italic" th:if="${fieldEngineeringSurvey}">Комплексные инженерные изыскания: Да</p>
            <p class="fst-italic" th:if="${!fieldEngineeringSurvey}">Полевые инженерные изыскания: Нет</p>
            <p class="fst-italic" th:if="${engineeringSurveyReport}">Камеральные инженерные изыскания: Да</p>
            <p class="fst-italic" th:if="${!engineeringSurveyReport}">Камеральные инженерные изыскания: Нет</p>
            <p class="fst-italic">Количество скважин для инженерной подготовки:
                [[${dataFormOilPad.backfillWell.well}]]</p>
            <p class="fst-italic" th:if="${dataFormOilPad.road.active}">Автомобильная дорога категории
                [[${dataFormOilPad.road.category}]]
                протяженностью [[${dataFormOilPad.road.length}]] км</p>
            <p class="fst-italic" th:if="${dataFormOilPad.road.bridgeExist}">Дорожные мосты в количестве:
                [[${dataFormOilPad.road.bridgeRoadCount}]] шт.,
                общей протяженностью [[${dataFormOilPad.road.bridgeRoadLength}]] м</p>
            <p class="fst-italic" th:if="${dataFormOilPad.line.active}">ВЛ напряжением [[${dataFormOilPad.line.power}]]
                кВ протяженностью
                [[${dataFormOilPad.line.length}]] км</p>
            <p class="fst-italic" th:if="${dataFormOilPad.mupn.active}">Площадка для МУПН площадью
                [[${dataFormOilPad.mupn.square}]] га</p>
            <p class="fst-italic" th:if="${dataFormOilPad.vec.active}">Площадка для ВЭЦ площадью
                [[${dataFormOilPad.vec.square}]] га</p>
            <p class="fst-italic" th:if="${dataFormOilPad.vvp.active}">Временная вертолетная площадка для
                [[${dataFormOilPad.vvp.helicopterModel}]] площадью [[${dataFormOilPad.vvp.square}]] га</p>
            <p class="fst-italic" th:if="${dataFormOilPad.vvp.hallExist}">с залом ожидания</p>
            <p class="fst-italic" th:if="${dataFormOilPad.cableRack.active}">Кабельная эстакада протяженностью
                [[${dataFormOilPad.cableRack.length}]] м</p>
            <p class="fst-italic" th:if="${dataFormOilPad.vjk.active}">Площадка для ВЖК площадью
                [[${dataFormOilPad.vjk.square}]] га</p>
            <hr>
            <table th:border="1" th:width="700" class="table table-hover table-light text-center">
                <thead>
                <tr>
                    <th>№ этапа</th>
                    <th>Наименование этапа работ</th>
                    <th>Дата начала</th>
                    <th>Дата окончания</th>
                </tr>
                </thead>
                <tbody>
                <th:block th:each="calendar : ${calendars}">
                    <tr>
                        <td colspan="4" th:align="center">
                            <div id="projectStage"><b>Этап строительства
                                &nbsp;[[${calendar.stage}]]</b></div>
                        </td>
                    </tr>
                    <tr th:if="${fieldEngineeringSurvey}">
                        <td>Полевые инженерные изыскания</td>
                        <td th:align="center" th:text="${calendar.startContract}"></td>
                        <td th:align="center" th:text="${calendar.engineeringSurvey}"></td>
                    </tr>
                    <tr th:if="${engineeringSurveyReport}">
                        <td>Отчет по инженерным изысканиям</td>
                        <td th:align="center" th:text="${calendar.engineeringSurvey}"></td>
                        <td th:align="center" th:text="${calendar.engineeringSurveyReport}"></td>
                    </tr>
                    <tr th:if="${engineeringSurveyReport}">
                        <td style="padding-bottom: 35px">Согласование инженерных изысканий</td>
                        <td th:align="center" th:text="${calendar.engineeringSurveyReport}"></td>
                        <td th:align="center" th:text="${calendar.agreementEngineeringSurvey}"></td>
                    </tr>
                    <tr></tr>
                    <tr>
                        <td>Рабочая документация</td>
                        <td th:align="center" th:text="${calendar.workingStart}"></td>
                        <td th:align="center" th:text="${calendar.workingFinish}"></td>
                    </tr>
                    <tr>
                        <td>Согласование рабочей документации</td>
                        <td th:align="center" th:text="${calendar.workingFinish}"></td>
                        <td th:align="center" th:text="${calendar.agreementWorking}"></td>
                    </tr>
                    <tr>
                        <td>Сметная документация</td>
                        <td th:align="center" th:text="${calendar.workingFinish}"></td>
                        <td th:align="center" th:text="${calendar.estimatesFinish}"></td>
                    </tr>
                    <tr>
                        <td style="padding-bottom: 35px">Согласование сметной документации</td>
                        <td th:align="center" th:text="${calendar.estimatesFinish}"></td>
                        <td th:align="center" th:text="${calendar.agreementEstimates}"></td>
                    </tr>
                    <tr></tr>
                    <tr>
                        <td>Проектная документация</td>
                        <td th:align="center" th:text="${calendar.workingFinish}"></td>
                        <td th:align="center" th:text="${calendar.projectFinish}"></td>
                    </tr>
                    <tr>
                        <td>Согласование проектной документации</td>
                        <td th:align="center" th:text="${calendar.projectFinish}"></td>
                        <td th:align="center" th:text="${calendar.agreementProject}"></td>
                    </tr>
                    <tr>
                        <td style="padding-bottom: 35px">Экспертиза проектной документации</td>
                        <td th:align="center" th:text="${calendar.agreementProject}"></td>
                        <td th:align="center" th:text="${calendar.examination}"></td>
                    </tr>
                    <tr></tr>
                    <tr>
                        <td style="padding-bottom: 35px">Землеустроительная документация</td>
                        <td th:align="center" th:text="${calendar.projectFinish}"></td>
                        <td th:align="center" th:text="${calendar.landFinish}"></td>
                    </tr>
                    <br>
                </th:block>
                </tbody>
            </table>
        </div>
    </div>
    <br>
    <div class="card text-center">
        <form class="card" id="goToBackfillWell1" method="GET" th:action="@{/calendar/to_desktop}">
            <div class="card text-center">
                <input type="hidden" name="codeContract" th:value="${codeContract}"/>
                <button type="submit" class="btn btn-outline-secondary fw-bolder">Выгрузить в Excel</button>
            </div>
        </form>
        <br>
        <a class="btn btn-outline-secondary fw-bolder " href="../index.html" th:href="@{/}">
            Вернуться на начальную страницу</a><br>
        <a id="goToBackfillWell3" class="btn btn-outline-secondary fw-bolder" href="../backfill-well.html"
           th:href="@{/oil_pad_object/backfill_well}">Перейти
            на страницу ввода данных нового проекта</a>
    </div>
    <script>
        // Проверка, откуда пришел пользователь для формирования кнопок
        if (document.referrer && document.referrer.endsWith('/oil_pad_object/backfill_well') ||
            document.referrer && document.referrer.endsWith('/oil_pad_object/backfill_well/calendar')) {
            document.getElementById('goToBackfillWell3').style.display = 'block';
        } else {
            document.getElementById('goToBackfillWell3').style.display = 'none';
        }
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let group = 0;
            let counter = 1;
            var engineeringSurvey = Boolean().valueOf("${fieldEngineeringSurvey}");
            var surveyReport = Boolean().valueOf("${engineeringSurveyReport}");
            // Проходимся по каждой строке таблицы
            document.querySelectorAll('tr').forEach(function (row) {
                // Проверяем, что строка не является заголовком
                if (!row.querySelector('th')) {
                    // Проверяем, содержит ли строка текст "Этап проектирования"
                    if (!row.textContent.includes('Этап строительства')) {
                        // Проверяем, не пустая ли строка
                        if (row.querySelectorAll('td').length > 0) {
                            let numbering = document.createElement('td');
                            numbering.textContent = group + '.' + counter;
                            row.insertBefore(numbering, row.firstElementChild);
                            counter++;
                        } else {
                            group++;
                            counter = 1;
                        }
                    } else {
                        group++;
                        counter = 1;
                        if (!engineeringSurvey && !surveyReport) {
                            group--;
                        }
                    }
                }
            });
        });
    </script>
    <hr class="my-4">
</th:block>
</html>